@import 'Styles/variables';
@import 'Styles/colors';
@import 'Styles/mixins';

$color-line: #5d6c76;
$color-label-bg: palette(base, 400);
$color-label-border: palette(base, 200);
$color-node-bg: palette(base, 600);

$small-radius: 2 * $grid-unit;
$big-radius: 2 * $small-radius;

$animation-duration: 0.8s;
@mixin animate($field) {
  transition: $field ease $animation-duration;
}

.node {
  .circlesG {
    &:hover {
      filter: url('#glow');

      + g.labelG {
        .nodeLabel {
          fill: font-color(white);
        }

        line {
          stroke: white;
        }
        rect {
          filter: url('#glowLow');
        }
        text {
          fill: font-color(white);
        }
      }
    }
  }
  .innerCircle {
    pointer-events: none;
    @include animate(fill);
  }
  .outerCircle {
    fill: $color-node-bg;
    cursor: pointer;
    @include animate(stroke);
  }

  &.#{$status-down} {
    .innerCircle {
      fill: $color-status-down;

      animation: anim-down 0.4s ease;
    }
    .outerCircle {
      stroke: $color-status-down;
    }

    .animOuterCircle {
      fill: $color-status-down;
      animation: anim-bg 0.6s ease;
    }
  }
  &.#{$status-loading} {
    .innerCircle {
      fill: $color-status-changing;

      animation: anim-state-change 2.5s linear 0s infinite;
    }
    .outerCircle {
      stroke: $color-status-changing;
    }
  }
  &.#{$status-up} {
    .innerCircle {
      fill: $color-status-up;

      animation: anim-up 0.6s ease;
    }
    .outerCircle {
      stroke: $color-status-up;
    }

    .animOuterCircle {
      fill: $color-status-up;
      animation: anim-bg 0.6s ease;
    }
  }
}

.inputNode {
  cursor: pointer;

  &.hovered {
    filter: url('#glow');
  }

  .shape,
  .nodePeak,
  .peakCut {
    @include animate(fill);
    fill: $bg-box;
    stroke: transparent;
  }

  &.#{$status-down} {
    .shape,
    .nodePeak {
      stroke: $color-status-down;
    }

    .icon > svg > path {
      fill: $color-status-down;
    }
  }

  &.#{$status-up} {
    .shape,
    .nodePeak,
    .peakCut {
      fill: $color-status-up;
    }

    .icon > svg > path {
      fill: font-color(dark);
    }
  }

  .icon > svg > path {
    @include animate(stroke);
    stroke: transparent !important;
  }
}

.outputNode {
  .shape,
  .nodePeak,
  .peakCut {
    @include animate(fill);
    fill: $bg-box;
    stroke: transparent;
  }

  &.#{$status-down} {
    .shape,
    .nodePeak {
      stroke: $color-status-down;
    }

    .icon > svg > path {
      fill: $color-status-down;
    }
  }

  &.#{$status-up} {
    .shape {
      fill: $color-status-up;
    }

    .icon > svg > path {
      fill: font-color(dark);
    }
  }

  .icon > svg > path {
    @include animate(stroke);
    stroke: transparent !important;
    fill: font-color(lowlight);
  }
}

.nodeLabel {
  @include font-small;

  fill: font-color(lowlight);
  transition: fill ease 0.4s;
  text-anchor: middle;
}

.nodeLabelRect {
  fill: $color-label-bg;
  stroke: $color-label-border;
  rx: 4px;
}
.nodeLabelLine {
  stroke: $color-line;
  stroke-dasharray: 2.5;
}

.nodesG,
.edgesG,
.node,
.inputNode,
.outputNode,
.lineG,
.line,
.path,
.innerCircle {
  display: block;
}
.lineG {
  line {
    stroke-dasharray: 5;
  }
  line,
  path {
    @include animate(stroke);
  }

  &.#{$status-down} {
    line,
    path {
      stroke: $color-status-down;
    }
  }
  &.#{$status-up} {
    line,
    path {
      stroke: $color-status-up;
    }
  }
}

.clicksDisabled {
  cursor: default !important;
}

@keyframes anim-up {
  0% {
    r: $small-radius;
  }
  50% {
    r: $small-radius + 2px;
  }
  100% {
    r: $small-radius;
  }
}

@keyframes anim-bg {
  0% {
    r: $big-radius;
    fill-opacity: 0.4;
  }
  100% {
    r: $big-radius + $grid-unit;
    fill-opacity: 0;
  }
}

@keyframes anim-down {
  0% {
    r: $small-radius;
  }
  50% {
    r: $small-radius - 1px;
  }
  100% {
    r: $small-radius;
  }
}

@keyframes anim-state-change {
  0% {
    fill-opacity: 0.8;
  }
  50% {
    fill-opacity: 0.3;
  }
  100% {
    fill-opacity: 0.8;
  }
}

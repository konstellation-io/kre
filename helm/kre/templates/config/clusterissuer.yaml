{{- if and ( eq .Values.certManager.enabled true) ( eq .Values.entrypoint.tls true) }}
{{ if .Capabilities.APIVersions.Has "cert-manager.io/v1alpha3" }}
apiVersion: cert-manager.io/v1alpha3
{{ else }}
apiVersion: cert-manager.io/v1
{{ end }}
kind: ClusterIssuer
metadata:
  name: {{ include "runtime.name" . }}-clusterissuer-runtimes-entrypoints
spec:
  acme:
    server: {{ .Values.certManager.acme.server }}
    email: {{ .Values.certManager.acme.email }}
    privateKeySecretRef:
      name: clusterissuer-runtimes
    solvers:
      {{- with .Values.certManager.dns01 }}
      - dns01:
        {{- toYaml . | nindent 10 }}
      {{- end }}
      {{- with .Values.certManager.http01 }}
      - http01:
        {{- toYaml . | nindent 10 }}
      {{- end }}
  {{- end }}
